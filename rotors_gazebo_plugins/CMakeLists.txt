cmake_minimum_required(VERSION 2.8.3)
project(rotors_gazebo_plugins)

add_definitions(-std=c++11)

# To enable assertions when compiled in release mode.
add_definitions(-DROS_ASSERT_ENABLED)

find_package(catkin REQUIRED COMPONENTS
  cmake_modules
  cv_bridge
  geometry_msgs
  image_transport
  mav_msgs
  message_generation
  octomap_msgs
  octomap_ros
  rosbag
  roscpp
  rotors_comm
  rotors_control
  std_srvs
  tf
)

find_package(Qt4)

find_package(Eigen REQUIRED)
find_package(octomap REQUIRED)
find_package(gazebo REQUIRED)
find_package(OpenCV REQUIRED)
find_package(Protobuf REQUIRED)

include (${QT_USE_FILE})
add_definitions(${QT_DEFINITIONS})

link_directories(${GAZEBO_LIBRARY_DIRS})
include_directories(SYSTEM ${GAZEBO_INCLUDE_DIRS})
include_directories(${OpenCV_INCLUDE_DIRS})

set (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${GAZEBO_CXX_FLAGS}")

QT4_WRAP_CPP(headers_view_control include/rotors_gazebo_plugins/gazebo_view_control_plugin.h)
QT4_WRAP_CPP(headers_map_tracker include/rotors_gazebo_plugins/gazebo_map_tracker_plugin.h)

catkin_package(
  INCLUDE_DIRS include ${Eigen_INCLUDE_DIRS}
  LIBRARIES rotors_gazebo_motor_model rotors_gazebo_controller_interface
  CATKIN_DEPENDS cv_bridge geometry_msgs image_transport mav_msgs octomap_msgs octomap_ros rosbag roscpp rotors_comm rotors_control std_srvs tf
  DEPENDS eigen gazebo octomap opencv
)

include_directories(include ${catkin_INCLUDE_DIRS} ${Eigen_INCLUDE_DIRS})

add_library(rotors_gazebo_rendering src/rendering_force.cpp src/rendering_torque.cpp)
target_link_libraries(rotors_gazebo_rendering ${GAZEBO_LIBRARIES})

add_library(rotors_gazebo_motor_model src/gazebo_motor_model.cpp)
target_link_libraries(rotors_gazebo_motor_model ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_motor_model ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_odometry_plugin src/gazebo_odometry_plugin.cpp)
target_link_libraries(rotors_gazebo_odometry_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES} ${OpenCV_LIBRARIES})
add_dependencies(rotors_gazebo_odometry_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_imu_plugin src/gazebo_imu_plugin.cpp)
target_link_libraries(rotors_gazebo_imu_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_imu_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_controller_interface src/gazebo_controller_interface.cpp)
target_link_libraries(rotors_gazebo_controller_interface ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_controller_interface ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_bag_plugin src/gazebo_bag_plugin.cpp)
target_link_libraries(rotors_gazebo_bag_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_bag_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_wind_plugin src/gazebo_wind_plugin.cpp)
target_link_libraries(rotors_gazebo_wind_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_wind_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_octomap_plugin src/gazebo_octomap_plugin.cpp)
target_link_libraries(rotors_gazebo_octomap_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_octomap_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_multirotor_base_plugin src/gazebo_multirotor_base_plugin.cpp)
target_link_libraries(rotors_gazebo_multirotor_base_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_multirotor_base_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_gps_plugin src/gazebo_gps_plugin.cpp)
target_link_libraries(rotors_gazebo_gps_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_gps_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_magnetometer_plugin src/gazebo_magnetometer_plugin.cpp)
target_link_libraries(rotors_gazebo_magnetometer_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_magnetometer_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_pressure_plugin src/gazebo_pressure_plugin.cpp)
target_link_libraries(rotors_gazebo_pressure_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_pressure_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_air_speed_plugin src/gazebo_air_speed_plugin.cpp)
target_link_libraries(rotors_gazebo_air_speed_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_air_speed_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_control_surface_plugin src/gazebo_control_surface_plugin.cpp)
target_link_libraries(rotors_gazebo_control_surface_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_control_surface_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_camera_plugin src/gazebo_camera_plugin.cpp)
target_link_libraries(rotors_gazebo_camera_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_camera_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_aerodynamics_plugin src/gazebo_aerodynamics_plugin.cpp)
target_link_libraries(rotors_gazebo_aerodynamics_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(rotors_gazebo_aerodynamics_plugin ${catkin_EXPORTED_TARGETS})

add_library(gps_temp src/gps_temp.cpp)
target_link_libraries(gps_temp ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(gps_temp ${catkin_EXPORTED_TARGETS})

add_library(gps_test src/gps_test.cpp)
target_link_libraries(gps_temp ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(gps_temp ${catkin_EXPORTED_TARGETS})

add_library(aero_visual_plugin src/aero_visual_plugin.cpp)
target_link_libraries(aero_visual_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES})
add_dependencies(aero_visual_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_view_control_plugin SHARED ${headers_view_control} src/gazebo_view_control_plugin.cpp)
target_link_libraries(rotors_gazebo_view_control_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES} ${QT_LIBRARIES}
  ${PROTOBUF_LIBRARIES} rotors_gazebo_rendering)
add_dependencies(rotors_gazebo_view_control_plugin ${catkin_EXPORTED_TARGETS})

add_library(rotors_gazebo_map_tracker_plugin SHARED ${headers_map_tracker} src/gazebo_map_tracker_plugin.cpp)
target_link_libraries(rotors_gazebo_map_tracker_plugin ${catkin_LIBRARIES} ${GAZEBO_LIBRARIES} ${QT_LIBRARIES} ${PROTOBUF_LIBRARIES})
add_dependencies(rotors_gazebo_map_tracker_plugin ${catkin_EXPORTED_TARGETS})

install(
  TARGETS
    rotors_gazebo_motor_model
    rotors_gazebo_odometry_plugin
    rotors_gazebo_imu_plugin
    rotors_gazebo_controller_interface
    rotors_gazebo_bag_plugin
    rotors_gazebo_wind_plugin
    rotors_gazebo_octomap_plugin
    rotors_gazebo_multirotor_base_plugin
    rotors_gazebo_gps_plugin
    rotors_gazebo_magnetometer_plugin
    rotors_gazebo_pressure_plugin
    rotors_gazebo_air_speed_plugin
    rotors_gazebo_control_surface_plugin
    rotors_gazebo_camera_plugin
    rotors_gazebo_aerodynamics_plugin
    rotors_gazebo_view_control_plugin
    rotors_gazebo_map_tracker_plugin
    gps_temp
    gps_test
    aero_visual_plugin
  DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION}
  LIBRARY DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
)
